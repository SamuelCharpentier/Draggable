{"version":3,"sources":["../../src/index.ts"],"names":[],"mappings":"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","sourcesContent":["type Position = { x: number; y: number };\n\ntype StampedPosition = {\n\ttimestamp: number;\n\tposition: {\n\t\tx: number;\n\t\ty: number;\n\t};\n};\n\nfunction isStampedPosition(\n\tdata: any,\n): data is StampedPosition {\n\treturn (\n\t\tdata?.timestamp !== undefined &&\n\t\tdata?.position.x !== undefined &&\n\t\tdata?.position.y !== undefined &&\n\t\ttypeof data.timestamp === 'number' &&\n\t\ttypeof data.position.x === 'number' &&\n\t\ttypeof data.position.y === 'number'\n\t);\n}\n\nexport class Dragable {\n\tDOMelement: HTMLElement;\n\tprivate mouseData: {\n\t\tmouseMove?: {\n\t\t\tpresent: StampedPosition;\n\t\t\tlast: StampedPosition;\n\t\t};\n\t\tmouseDown?: StampedPosition;\n\t};\n\tdirection: { x: boolean; y: boolean };\n\ttranslatePosition?: Position;\n\tslide: boolean;\n\tprivate animationOptions: {\n\t\tduration: number;\n\t\teasingFactor: number;\n\t};\n\tbounce: boolean;\n\tprivate velocity?: {\n\t\tspeed: number;\n\t\tangle: number;\n\t};\n\tprivate slideAnimation?: {\n\t\tstartTimestamp: number;\n\t\ttimestamp: number;\n\t\trafID: number;\n\t};\n\tmouseEnterHandler: () => void;\n\tmouseLeaveHandler: () => void;\n\tmouseDownHandler: (event: MouseEvent) => void;\n\tmouseUpHandler: (event: MouseEvent) => void;\n\tmouseMoveHandler: (event: MouseEvent) => void;\n\n\tconstructor(\n\t\tDOMelement: HTMLElement | null,\n\t\t{\n\t\t\tslide = true,\n\t\t\tslideOptions: {\n\t\t\t\tduration = 1500,\n\t\t\t\teasingFactor = 4,\n\t\t\t} = {\n\t\t\t\tduration: 1500,\n\t\t\t\teasingFactor: 4,\n\t\t\t},\n\t\t\tbounce = true,\n\t\t\taxis: { x = true, y = true } = {\n\t\t\t\tx: true,\n\t\t\t\ty: true,\n\t\t\t},\n\t\t}: {\n\t\t\tslide?: boolean;\n\t\t\tslideOptions?: {\n\t\t\t\tduration?: number;\n\t\t\t\teasingFactor: number;\n\t\t\t};\n\t\t\tbounce?: boolean;\n\n\t\t\taxis?: { x: boolean; y: boolean };\n\t\t} = {},\n\t) {\n\t\tif (!DOMelement)\n\t\t\tthrow new Error('DOMelement not found');\n\t\tthis.DOMelement = DOMelement;\n\t\tthis.mouseData = {};\n\t\tthis.slide = slide;\n\t\tthis.animationOptions = {\n\t\t\tduration,\n\t\t\teasingFactor,\n\t\t};\n\t\tthis.direction = { x, y };\n\t\tthis.bounce = bounce;\n\t\tthis.mouseEnterHandler =\n\t\t\tthis.mouseEnterMethod.bind(this);\n\t\tthis.mouseLeaveHandler =\n\t\t\tthis.mouseLeaveMethod.bind(this);\n\t\tthis.mouseDownHandler =\n\t\t\tthis.mouseDownMethod.bind(this);\n\t\tthis.mouseUpHandler = this.mouseUpMethod.bind(this);\n\t\tthis.mouseMoveHandler =\n\t\t\tthis.mouseMoveMethod.bind(this);\n\t\tthis.DOMelement.addEventListener(\n\t\t\t'mouseenter',\n\t\t\tthis.mouseEnterHandler,\n\t\t);\n\t\tthis.DOMelement.addEventListener(\n\t\t\t'mouseleave',\n\t\t\tthis.mouseLeaveHandler,\n\t\t);\n\t}\n\n\tmouseEnterMethod(): void {\n\t\tdocument.addEventListener(\n\t\t\t'mousedown',\n\t\t\tthis.mouseDownHandler,\n\t\t);\n\t}\n\n\tmouseLeaveMethod(): void {\n\t\tdocument.removeEventListener(\n\t\t\t'mousedown',\n\t\t\tthis.mouseDownHandler,\n\t\t);\n\t}\n\n\tmouseDownMethod(event: MouseEvent): void {\n\t\tevent.preventDefault();\n\t\tthis.stopSlideAnimation();\n\t\tthis.setMouseDownData(event, Date.now());\n\t\tdocument.addEventListener(\n\t\t\t'mouseup',\n\t\t\tthis.mouseUpHandler,\n\t\t);\n\t\tdocument.addEventListener(\n\t\t\t'mousemove',\n\t\t\tthis.mouseMoveHandler,\n\t\t);\n\t}\n\n\tsetMouseDownData(\n\t\t{ pageX: x, pageY: y }: MouseEvent,\n\t\ttimestamp: number,\n\t): void {\n\t\tthis.mouseData.mouseDown = {\n\t\t\ttimestamp,\n\t\t\tposition: {\n\t\t\t\tx,\n\t\t\t\ty,\n\t\t\t},\n\t\t};\n\t}\n\n\tmouseMoveMethod(event: MouseEvent): void {\n\t\tthis.drag(this.setMouseMoveData(event, Date.now()));\n\t}\n\n\tsetMouseMoveData(\n\t\t{ pageX, pageY }: MouseEvent,\n\t\ttimestamp: number,\n\t): {\n\t\tpresent: StampedPosition;\n\t\tlast: StampedPosition;\n\t} {\n\t\tif (!isStampedPosition(this.mouseData.mouseDown))\n\t\t\tthrow new Error('mouseDown is undefined');\n\t\tconst last = isStampedPosition(\n\t\t\tthis.mouseData.mouseMove?.present,\n\t\t)\n\t\t\t? this.mouseData.mouseMove.present\n\t\t\t: this.mouseData.mouseDown;\n\t\tconst present: StampedPosition = {\n\t\t\tposition: {\n\t\t\t\tx: pageX,\n\t\t\t\ty: pageY,\n\t\t\t},\n\t\t\ttimestamp,\n\t\t};\n\t\treturn (this.mouseData.mouseMove = {\n\t\t\tlast,\n\t\t\tpresent,\n\t\t});\n\t}\n\n\tdrag({\n\t\tpresent,\n\t\tlast,\n\t}: {\n\t\tpresent: StampedPosition;\n\t\tlast: StampedPosition;\n\t}): void {\n\t\tconst distanceX: number =\n\t\t\tpresent.position.x - last.position.x;\n\t\tconst distanceY: number =\n\t\t\tpresent.position.y - last.position.y;\n\t\tthis.translate({ distanceX, distanceY });\n\t}\n\n\tmouseUpMethod(event: MouseEvent): void {\n\t\tevent.preventDefault();\n\t\tif (this.slide && this.setReleaseVelocity())\n\t\t\tthis.startAnimateSlide();\n\t\tthis.mouseData = {};\n\t\tdocument.removeEventListener(\n\t\t\t'mouseup',\n\t\t\tthis.mouseUpHandler,\n\t\t);\n\t\tdocument.removeEventListener(\n\t\t\t'mousemove',\n\t\t\tthis.mouseMoveHandler,\n\t\t);\n\t}\n\n\tsetReleaseVelocity(): boolean {\n\t\tif (this.mouseData.mouseMove === undefined)\n\t\t\treturn false;\n\n\t\tconst { present, last } = this.mouseData.mouseMove;\n\n\t\tconst timeDif = present.timestamp - last.timestamp;\n\n\t\tconst deltaX = present.position.x - last.position.x;\n\t\tconst deltaY = present.position.y - last.position.y;\n\n\t\tconst distance = Math.sqrt(\n\t\t\tMath.pow(deltaX, 2) + Math.pow(deltaY, 2),\n\t\t);\n\n\t\tlet speed = Math.min(distance / timeDif, 10);\n\t\tif (speed <= 0.2) return false;\n\n\t\tthis.velocity = {\n\t\t\tspeed,\n\t\t\tangle: Math.atan2(deltaY, deltaX),\n\t\t};\n\t\treturn true;\n\t}\n\n\tstartAnimateSlide() {\n\t\tthis.slideAnimation = {\n\t\t\trafID: requestAnimationFrame(\n\t\t\t\tthis.animateSlide.bind(this),\n\t\t\t),\n\t\t\ttimestamp: Date.now(),\n\t\t\tstartTimestamp: Date.now(),\n\t\t};\n\t}\n\n\tanimateSlide(): void {\n\t\tif (\n\t\t\tthis.velocity === undefined ||\n\t\t\tthis.slideAnimation === undefined\n\t\t)\n\t\t\treturn;\n\n\t\tconst timestamp = Date.now();\n\n\t\tconst timeDifStart =\n\t\t\ttimestamp - this.slideAnimation.startTimestamp;\n\n\t\tif (timeDifStart < this.animationOptions.duration) {\n\t\t\tconst timeDifLastFrame =\n\t\t\t\ttimestamp - this.slideAnimation.timestamp;\n\n\t\t\tconst progress =\n\t\t\t\t(timeDifStart - timeDifLastFrame / 2) /\n\t\t\t\tthis.animationOptions.duration;\n\n\t\t\tconst easing = this.easeOutProgress(progress);\n\n\t\t\tconst { speed, angle } = this.velocity;\n\n\t\t\tconst easedSpeedByFrameDuration =\n\t\t\t\tspeed * easing * timeDifLastFrame;\n\n\t\t\tconst distanceX =\n\t\t\t\tMath.cos(angle) * easedSpeedByFrameDuration;\n\t\t\tconst distanceY =\n\t\t\t\tMath.sin(angle) * easedSpeedByFrameDuration;\n\n\t\t\tthis.translate({\n\t\t\t\tdistanceX,\n\t\t\t\tdistanceY,\n\t\t\t});\n\t\t\tthis.slideAnimation.timestamp = timestamp;\n\t\t\tthis.slideAnimation.rafID =\n\t\t\t\trequestAnimationFrame(\n\t\t\t\t\tthis.animateSlide.bind(this),\n\t\t\t\t);\n\t\t} else {\n\t\t\tthis.stopSlideAnimation();\n\t\t}\n\t}\n\n\teaseOutProgress(progress: number) {\n\t\treturn Math.pow(\n\t\t\t1 - progress,\n\t\t\tthis.animationOptions.easingFactor,\n\t\t);\n\t}\n\n\tstopSlideAnimation(): void {\n\t\tif (this.slideAnimation !== undefined)\n\t\t\tcancelAnimationFrame(this.slideAnimation.rafID);\n\t\tthis.slideAnimation = undefined;\n\t\tthis.translatePosition = undefined;\n\t}\n\n\ttranslate({\n\t\tdistanceX = 0,\n\t\tdistanceY = 0,\n\t}: {\n\t\tdistanceX?: number;\n\t\tdistanceY?: number;\n\t} = {}): void {\n\t\tif (this.translatePosition === undefined)\n\t\t\tthis.translatePosition =\n\t\t\t\tthis.getCurrentTranslate();\n\t\tif (this.direction.x)\n\t\t\tthis.translatePosition.x += distanceX;\n\t\tif (this.direction.y)\n\t\t\tthis.translatePosition.y += distanceY;\n\t\tif (this.direction.x || this.direction.y)\n\t\t\tthis.DOMelement.style.transform = `translate(${this.translatePosition.x}px, ${this.translatePosition.y}px)`;\n\t}\n\n\tgetCurrentTranslate(): { x: number; y: number } {\n\t\tlet currentTranslateX = 0;\n\t\tlet currentTranslateY = 0;\n\t\tconst computedStyle = window.getComputedStyle(\n\t\t\tthis.DOMelement,\n\t\t);\n\t\tconst transform = computedStyle.transform;\n\t\tif (transform && transform !== 'none') {\n\t\t\tconst matrix = transform\n\t\t\t\t.replace(/[^0-9\\-.,]/g, '')\n\t\t\t\t.split(',');\n\t\t\tcurrentTranslateX = parseInt(\n\t\t\t\tmatrix[12] || matrix[4],\n\t\t\t\t10,\n\t\t\t);\n\t\t\tcurrentTranslateY = parseInt(\n\t\t\t\tmatrix[13] || matrix[5],\n\t\t\t\t10,\n\t\t\t);\n\t\t}\n\t\treturn {\n\t\t\tx: currentTranslateX,\n\t\t\ty: currentTranslateY,\n\t\t};\n\t}\n\n\tresetTranslate(): void {\n\t\tconst currentTranslate = this.getCurrentTranslate();\n\t\tif (\n\t\t\tcurrentTranslate.x === 0 &&\n\t\t\tcurrentTranslate.y === 0\n\t\t)\n\t\t\treturn;\n\t\tthis.DOMelement.style.transition =\n\t\t\t'all 0.2s ease-out';\n\t\tthis.DOMelement.style.transform =\n\t\t\t'translate(0px, 0px)';\n\t\tthis.DOMelement.addEventListener(\n\t\t\t'transitionend',\n\t\t\t() => {\n\t\t\t\tthis.DOMelement.style.transition = '';\n\t\t\t},\n\t\t);\n\t}\n}\n"]}